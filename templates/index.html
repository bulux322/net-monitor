<!DOCTYPE html>
<html>
<head>
    <title>Net Monitor HUD</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background: radial-gradient(circle at top, #020617, #000);
            color: #e5e7eb;
            font-family: "Orbitron", monospace;
            text-align: center;
            /*zoom: 1.2; /* cocok buat TV */
        }

        h1 {
            margin-top: 10px;
            color: #38bdf8;
        }

        /* HUD BAR */
        .hud {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 20px auto;
            padding: 15px 30px;
            border: 2px solid #1e3a8a;
            border-radius: 12px;
            width: fit-content;
            background: rgba(2, 6, 23, 0.8);
            box-shadow: 0 0 20px #0ea5e9;
        }

        .hud-item {
            text-align: center;
        }

        .label {
            font-size: 14px;
            color: #94a3b8;
        }

        .value {
            font-size: 28px;
            margin-top: 5px;
        }

        .ok { color: #22c55e; }
        .warn { color: #facc15; }
        .bad { color: #ef4444; }

        /* PACKET LOSS BAR */
        .loss-container {
            width: 400px;
            margin: 20px auto;
            text-align: left;
        }

        .loss-bar-bg {
            width: 100%;
            height: 18px;
            background: #020617;
            border: 1px solid #1e293b;
            border-radius: 8px;
            overflow: hidden;
        }

        .loss-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #22c55e, #ef4444);
            transition: width 0.3s ease;
        }

        canvas {
            max-width: 900px;
            margin: 30px auto;
        }

        #chart {
            display: block;
            box-sizing: border-box;
            height: 650px;
            width: 1300px;
        }

        /* button */
        .control-panel {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px;
            align-items: center;
        }

        #clock {
            font-size: 20px;
            color: #38bdf8;
        }

        #targetInput {
            background: #020617;
            border: 1px solid #1e293b;
            color: #e5e7eb;
            padding: 6px;
            width: 160px;
        }

        button.start {
            background: #22c55e;
            color: black;
            border: 2px solid #1e3a8a;
            border-radius: 12px;
        }

        button.stop {
            background: #ef4444;
            color: white;
            border: 2px solid #1e3a8a;
            border-radius: 12px;
        }

        button {
            border: none;
            padding: 8px 16px;
            font-weight: bold;
            cursor: pointer;
        }

        /* status */
        .stable {
            color: #22c55e;
            text-shadow: 0 0 10px #22c55e;
        }

        .lag {
            color: #facc15;
            text-shadow: 0 0 10px #facc15;
        }

        .bad {
            color: #ef4444;
            text-shadow: 0 0 10px #ef4444;
        }

        .down {
            color: #9ca3af;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% { opacity: 0.3; }
        }

    </style>
</head>

<body>
    <h1>ðŸŽ® NET MONITOR HUD</h1>
    <div class="control-panel">
        <span id="clock">00:00:00</span>

        <input id="targetInput" placeholder="Target IP / Domain" value="8.8.8.8">

        <button id="toggleBtn" class="start">START</button>
    </div>

    <div class="hud">
        <div class="hud-item">
            <div class="label">ICMP RTT</div>
            <div id="icmp" class="value">-</div>
        </div>

        <div class="hud-item">
            <div class="label">PROC LAT</div>
            <div id="process" class="value">-</div>
        </div>

        <div class="hud-item">
            <div class="label">JITTER</div>
            <div id="jitter" class="value">0 ms</div>
        </div>

        <div class="hud-item">
            <div class="label">PACKET LOSS</div>
            <div id="loss" class="value">0%</div>
        </div>

        <div class="hud-item">
            <div class="label">RTO</div>
            <div id="rto" class="value ok">0</div>
        </div>

        <div class="hud-item">
            <div class="label">STATUS</div>
            <div id="status" class="value ok">OK</div>
        </div>
    </div>

    <div class="loss-container">
        <div class="label">Packet Loss Level</div>
        <div class="loss-bar-bg">
            <div id="lossBar" class="loss-bar"></div>
        </div>
    </div>

    <canvas id="chart"></canvas>

<script>
    let running = false;
    const socket = io();

    const ctx = document.getElementById("chart").getContext("2d");
    const chart = new Chart(ctx, {
        type: "line",
        data: {
            labels: [],
            datasets: [
                {
                    label: "ICMP RTT (ms)",
                    data: [],
                    borderWidth: 2,
                    tension: 0.3
                },
                {
                    label: "Process Latency (ms)",
                    data: [],
                    borderWidth: 2,
                    tension: 0.3
                }
            ]
        },
        options: {
            animation: false,
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: "Milliseconds"
                    }
                }
            }
        }
    });

    socket.on("ping_data", data => {
        // ICMP RTT
        document.getElementById("icmp").innerText =
            data.icmp_latency !== null ? `${data.icmp_latency} ms` : "LOSS";

        // PROCESS LATENCY
        document.getElementById("process").innerText =
            `${data.process_latency} ms`;

        // JITTER
        const jitterEl = document.getElementById("jitter");
        jitterEl.innerText = data.jitter + " ms";
        jitterEl.className = "value " +
            (data.jitter < 10 ? "ok" :
            data.jitter < 30 ? "warn" : "bad");

        // PACKET LOSS
        document.getElementById("loss").innerText = data.packet_loss + "%";
        document.getElementById("lossBar").style.width = data.packet_loss + "%";

        // RTO
        const rtoEl = document.getElementById("rto");
        rtoEl.innerText = data.rto;
        rtoEl.className = "value " +
            (data.rto === 0 ? "ok" :
            data.rto < 3 ? "warn" : "bad");

        // STATUS
        const statusEl = document.getElementById("status");
        statusEl.innerText = data.status;
        statusEl.className = "value " + (
            data.status === "STABLE" ? "stable" :
            data.status === "LAG" ? "lag" :
            data.status === "BAD" ? "bad" :
            "down"
        );

        // LIMIT DATA POINT
        if (chart.data.labels.length > 40) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
            chart.data.datasets[1].data.shift();
        }

        // PUSH DATA
        chart.data.labels.push(data.time);

        // ICMP RTT
        chart.data.datasets[0].data.push(
            data.icmp_latency !== null ? data.icmp_latency : 0
        );

        // PROCESS LATENCY
        chart.data.datasets[1].data.push(
            data.process_latency
        );

        chart.update();
    });
    
    // CLOCK
    setInterval(() => {
        document.getElementById("clock").innerText =
            new Date().toLocaleTimeString();
    }, 1000);

    // START / STOP
    const btn = document.getElementById("toggleBtn");
    btn.onclick = () => {
        if (!running) {
            socket.emit("start_monitor", {
                target: document.getElementById("targetInput").value
            });
            btn.innerText = "STOP";
            btn.className = "stop";
        } else {
            socket.emit("stop_monitor");
            btn.innerText = "START";
            btn.className = "start";
        }
        running = !running;
    };

    // STATUS SYNC
    socket.on("monitor_status", data => {
        running = data.running;
    });

</script>

</body>
</html>